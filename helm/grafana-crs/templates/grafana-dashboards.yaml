{{- range $path, $_ := .Files.Glob "files/grafana-dashboards/*.json" }}
{{- $name := $path | replace "files/grafana-dashboards/" "" | replace ".json" "" }}
---
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ $name }}
  namespace: monitoring
data:
  dashboard.json: |-
{{- $.Files.Get $path | nindent 4 }}
---
apiVersion: grafana.integreatly.org/v1beta1
kind: GrafanaDashboard
metadata:
  name: {{ $name }}
  namespace: monitoring
spec:
  instanceSelector:
    matchLabels:
      cr/managed-by: grafana-operator
  configMapRef:
    name: {{ $name }}
    key: dashboard.json
{{- end }}
